<!DOCTYPE html>
<html>
<head>
<title>RPG Content Generator</title>
<style>
body {
  font-family: sans-serif;
}

.tab {
  overflow: hidden;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
}

.tab button {
  background-color: inherit;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 14px 16px;
  transition: 0.3s;
}

.tab button:hover {
  background-color: #ddd;
}

.tab button.active {
  background-color: #ccc;
}

.tabcontent {
  display: none;
  padding: 6px 12px;
  border: 1px solid #ccc;
  border-top: none;
}

.row {
  display: flex;
}

.col-left {
  flex: 50%;
  padding: 10px;
}

.col-right {
  flex: 50%;
  padding: 10px;
  border-left: 1px solid #ccc;
}

.stat-block {
  border: 1px solid #ccc;
  padding: 10px;
}
</style>
</head>
<body>

<h2>RPG Content Generator</h2>

<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'MonsterCreator')">Monster Creator/Editor</button>
  <button class="tablinks" onclick="openTab(event, 'EncounterGenerator')">Encounter Generator</button>
  <button class="tablinks" onclick="openTab(event, 'LootGenerator')">Loot Generator</button>
  <button class="tablinks" onclick="openTab(event, 'CampaignGenerator')">Campaign Generator</button>
</div>

<div id="MonsterCreator" class="tabcontent">
  <div class="row">
    <div class="col-left">
      <h3>Monster Creator/Editor</h3>
      <label for="monsterSelect">Select Monster:</label><br>
      <select id="monsterSelect" onchange="loadMonster()"></select>
      <hr>
      <form id="monsterForm">
        <h4>Core Information</h4>
        <label for="monsterName">Name:</label><br>
        <input type="text" id="monsterName" name="monsterName" oninput="updateStatBlock()"><br>
        <label for="level">Level:</label><br>
        <input type="number" id="level" name="level" oninput="updateStatBlock()"><br>
        <label for="alignment">Alignment:</label><br>
        <input type="text" id="alignment" name="alignment" oninput="updateStatBlock()"><br>
        <label for="size">Size:</label><br>
        <input type="text" id="size" name="size" oninput="updateStatBlock()"><br>

        <h4>Defense</h4>
        <label for="armorClass">Armor Class:</label><br>
        <input type="number" id="armorClass" name="armorClass" oninput="updateStatBlock()"><br>
        <label for="hitPoints">Hit Points:</label><br>
        <input type="text" id="hitPoints" name="hitPoints" oninput="updateStatBlock()"><br>
        <label for="fortitude">Fortitude:</label><br>
        <input type="number" id="fortitude" name="fortitude" oninput="updateStatBlock()"><br>
        <label for="reflex">Reflex:</label><br>
        <input type="number" id="reflex" name="reflex" oninput="updateStatBlock()"><br>
        <label for="will">Will:</label><br>
        <input type="number" id="will" name="will" oninput="updateStatBlock()"><br>
      </form>
    </div>
    <div class="col-right">
      <h3>Stat Block</h3>
      <div id="statBlock" class="stat-block">
        <h4 id="statBlockName"></h4>
        <p>
          <b>Level:</b> <span id="statBlockLevel"></span><br>
          <b>Alignment:</b> <span id="statBlockAlignment"></span><br>
          <b>Size:</b> <span id="statBlockSize"></span><br>
        </p>
        <hr>
        <p>
          <b>Armor Class:</b> <span id="statBlockAC"></span><br>
          <b>Hit Points:</b> <span id="statBlockHP"></span><br>
          <b>Fortitude:</b> <span id="statBlockFortitude"></span><br>
          <b>Reflex:</b> <span id="statBlockReflex"></span><br>
          <b>Will:</b> <span id="statBlockWill"></span><br>
        </p>
      </div>
    </div>
  </div>
</div>

<div id="EncounterGenerator" class="tabcontent">
  <h3>Encounter Generator</h3>
  <label for="encounterBiomeSelect">Select Biome:</label><br>
  <select id="encounterBiomeSelect"></select><br><br>
  <button onclick="generateEncounter()">Generate Encounter</button>
  <hr>
  <h4>Generated Encounter:</h4>
  <div id="encounterOutput"></div>
</div>

<div id="LootGenerator" class="tabcontent">
  <h3>Loot Generator</h3>
  <label for="biomeSelect">Select Biome:</label><br>
  <select id="biomeSelect" onchange=""></select><br><br>
  <button onclick="generateLoot()">Generate Loot</button>
  <hr>
  <h4>Generated Loot:</h4>
  <ul id="lootList"></ul>
</div>

<div id="CampaignGenerator" class="tabcontent">
  <h3>Campaign Generator</h3>
  <label for="campaignIdea">Enter your campaign idea (optional):</label><br>
  <textarea id="campaignIdea" rows="5" cols="50"></textarea><br><br>
  <button onclick="generateCampaign()">Generate Campaign Premise</button>
  <hr>
  <h4>Generated Campaign Premise:</h4>
  <div id="campaignOutput"></div>
</div>

<script>
let monsters = [];
let locations = {};
let lootTables = {};
let items = {};

function openTab(evt, tabName) {
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(tabName).style.display = "block";
  evt.currentTarget.className += " active";
}

function updateStatBlock() {
  document.getElementById('statBlockName').innerText = document.getElementById('monsterName').value;
  document.getElementById('statBlockLevel').innerText = document.getElementById('level').value;
  document.getElementById('statBlockAlignment').innerText = document.getElementById('alignment').value;
  document.getElementById('statBlockSize').innerText = document.getElementById('size').value;
  document.getElementById('statBlockAC').innerText = document.getElementById('armorClass').value;
  document.getElementById('statBlockHP').innerText = document.getElementById('hitPoints').value;
  document.getElementById('statBlockFortitude').innerText = document.getElementById('fortitude').value;
  document.getElementById('statBlockReflex').innerText = document.getElementById('reflex').value;
  document.getElementById('statBlockWill').innerText = document.getElementById('will').value;
}

async function loadMonsters() {
  const response = await fetch('file:///C:/Users/pierr/OneDrive/Desktop/pf2e project/exported_data_json/monsters.json');
  const allData = await response.json();
  monsters = allData.filter(item => item.type === 'npc');
  const monsterSelect = document.getElementById('monsterSelect');
  monsters.forEach(monster => {
    const option = document.createElement('option');
    option.value = monster._id;
    option.text = monster.name;
    monsterSelect.appendChild(option);
  });
}

function loadMonster() {
  const monsterId = document.getElementById('monsterSelect').value;
  const monster = monsters.find(m => m._id === monsterId);

  if (monster) {
    document.getElementById('monsterName').value = monster.name;
    document.getElementById('level').value = monster.system.details.level.value;
    document.getElementById('alignment').value = monster.system.traits.value.find(t => t.startsWith('a')) || '';
    document.getElementById('size').value = monster.system.traits.size.value;
    document.getElementById('armorClass').value = monster.system.attributes.ac.value;
    document.getElementById('hitPoints').value = monster.system.attributes.hp.value;
    document.getElementById('fortitude').value = monster.system.saves.fortitude.value;
    document.getElementById('reflex').value = monster.system.saves.reflex.value;
    document.getElementById('will').value = monster.system.saves.will.value;

    updateStatBlock();
  }
}

async function loadLocations() {
  const response = await fetch('file:///C:/Users/pierr/rpg_generator/locations.json');
  locations = await response.json();
  const biomeSelect = document.getElementById('biomeSelect');
  const encounterBiomeSelect = document.getElementById('encounterBiomeSelect');
  for (const biome in locations) {
    const option = document.createElement('option');
    option.value = biome;
    option.text = biome.charAt(0).toUpperCase() + biome.slice(1);
    biomeSelect.appendChild(option);

    const encounterOption = document.createElement('option');
    encounterOption.value = biome;
    encounterOption.text = biome.charAt(0).toUpperCase() + biome.slice(1);
    encounterBiomeSelect.appendChild(encounterOption);
  }
}

async function generateEncounter() {
  const selectedBiome = document.getElementById('encounterBiomeSelect').value;
  const encounterOutput = document.getElementById('encounterOutput');
  encounterOutput.innerHTML = ''; // Clear previous encounter

  if (locations[selectedBiome]) {
    const factionsInBiome = locations[selectedBiome].factions;
    if (factionsInBiome.length > 0) {
      // Randomly select a primary faction for the encounter
      const primaryFaction = factionsInBiome[Math.floor(Math.random() * factionsInBiome.length)];
      encounterOutput.innerHTML += `<h4>Primary Faction: ${primaryFaction.charAt(0).toUpperCase() + primaryFaction.slice(1)}</h4>`;

      const possibleMonsters = monsters.filter(monster => {
        // Simple check for now: monster name contains a creature from the biome's primary faction
        // This will need to be refined with proper faction tagging in monster data
        return locations[selectedBiome].creatures[primaryFaction].some(creatureName => monster.name.toLowerCase().includes(creatureName));
      });

      if (possibleMonsters.length > 0) {
        const numMonsters = Math.floor(Math.random() * 3) + 1; // 1-3 monsters for now
        encounterOutput.innerHTML += `<p>Encountering ${numMonsters} ${primaryFaction}s:</p><ul>`;
        for (let i = 0; i < numMonsters; i++) {
          const randomMonster = possibleMonsters[Math.floor(Math.random() * possibleMonsters.length)];
          encounterOutput.innerHTML += `<li>${randomMonster.name} (Level ${randomMonster.system.details.level.value})</li>`;
        }
        encounterOutput.innerHTML += `</ul>`;
      } else {
        encounterOutput.innerHTML += `<p>No specific monsters found for ${primaryFaction} in ${selectedBiome}.</p>`;
      }

      // Add environmental flavor based on other factions in the biome
      const otherFactions = factionsInBiome.filter(f => f !== primaryFaction);
      if (otherFactions.length > 0) {
        encounterOutput.innerHTML += `<p>You also notice signs of other creatures in the area:</p><ul>`;
        otherFactions.forEach(otherFaction => {
          encounterOutput.innerHTML += `<li>Signs of ${otherFaction} activity.</li>`;
        });
        encounterOutput.innerHTML += `</ul>`;
      }

    } else {
      encounterOutput.innerHTML += `<p>No factions defined for this biome.</p>`;
    }
  } else {
    encounterOutput.innerHTML += `<p>Please select a biome.</p>`;
  }
}

async function loadLootTables() {
  const response = await fetch('file:///C:/Users/pierr/rpg_generator/loot_tables.json');
  lootTables = await response.json();
}

async function loadItems() {
  const response = await fetch('file:///C:/Users/pierr/OneDrive/Desktop/pf2e project/exported_data_json/items.json');
  items = await response.json();
}

function generateLoot() {
  const selectedBiome = document.getElementById('biomeSelect').value;
  const lootList = document.getElementById('lootList');
  lootList.innerHTML = ''; // Clear previous loot

  if (locations[selectedBiome]) {
    const factionsInBiome = locations[selectedBiome].factions;
    factionsInBiome.forEach(faction => {
      if (lootTables[faction]) {
        const factionLoot = lootTables[faction];
        for (const lootCategory in factionLoot) {
          factionLoot[lootCategory].forEach(lootItem => {
            if (Math.random() < lootItem.chance) {
              const itemDetails = items.find(item => item.name === lootItem.item_name);
              if (itemDetails) {
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                  <div class="tooltip">${itemDetails.name}
                    <span class="tooltiptext">
                      <b>${itemDetails.name}</b><br>
                      Type: ${itemDetails.type}<br>
                      Description: ${itemDetails.system.description.value}
                    </span>
                  </div>
                `;
                lootList.appendChild(listItem);
              } else {
                const listItem = document.createElement('li');
                listItem.innerText = lootItem.item_name; // Fallback if item not found in items.json
                lootList.appendChild(listItem);
              }
            }
          });
        }
      }
    });
  }
}

function generateCampaign() {
  const campaignIdea = document.getElementById('campaignIdea').value;
  const campaignOutput = document.getElementById('campaignOutput');
  campaignOutput.innerHTML = ''; // Clear previous premise

  let premise = "";
  if (campaignIdea) {
    premise = `Based on your idea: "${campaignIdea}", here's a campaign premise: A powerful artifact has been unearthed, and various factions are vying for control. Your party must secure it before it falls into the wrong hands, leading to a climactic confrontation in a forgotten ruin.`;
  } else {
    premise = "A dark prophecy foretells the return of an ancient evil. Heroes are needed to gather allies, uncover forgotten lore, and confront the rising darkness before it consumes the land.";
  }
  campaignOutput.innerHTML = `<p>${premise}</p>`;
}

window.onload = function() {
  loadMonsters();
  loadLocations();
  loadLootTables();
  loadItems();
  openTab(new Event('default'), 'MonsterCreator');
};
</script>

</body>
</html>
